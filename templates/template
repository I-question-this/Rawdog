<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
        <link rel="stylesheet" href="style.css" type="text/css">
        <title>rawdog</title>
        <script type="text/javascript">

            function getCookie(c_name) {
                var c_value = document.cookie;
                var c_start = c_value.indexOf(" " + c_name + "=");
                if (c_start == -1) {
                    c_start = c_value.indexOf(c_name + "=");
                }
                if (c_start == -1) {
                    c_value = null;
                }
                else {
                    c_start = c_value.indexOf("=", c_start) + 1;
                    var c_end = c_value.indexOf(";", c_start);
                    if (c_end == -1)
                    {
                        c_end = c_value.length;
                    }
                    c_value = unescape(c_value.substring(c_start,c_end));
                }
                return c_value;
            }

            /*function setCookie(c_name,value,exdays) {
                var exdate=new Date();
                exdate.setDate(exdate.getDate() + exdays);
                var c_value=escape(value) + ((exdays==null) ? "" : "; expires="+exdate.toUTCString());
                document.cookie=c_name + "=" + c_value;
            }*/
            function setCookie(cookieName,cookieValue,nDays) {
                var today = new Date();
                var expire = new Date();
                if (nDays==null || nDays==0) nDays=1;
                expire.setTime(today.getTime() + 3600000*24*nDays);
                document.cookie = cookieName+"="+escape(cookieValue)
                    + ";expires="+expire.toGMTString();
            }

            function checkCookie() {
                var username=getCookie("username");
                if (username!=null && username!="") {
                    alert("Welcome again " + username);
                }
                else {
                    username=prompt("Please enter your name:","");
                    if (username!=null && username!="") {
                        setCookie("username",username,365);
                    }
                }
            }
            var currentlyOpen = "none";

            document.onkeyup = KeyCheck;       

            function KeyCheck(e) {
                var KeyID = (window.event) ? event.keyCode : e.keyCode;

                switch(KeyID) {
                    case 74:
                        nextPrev("next"); 
                        break;
                    case 75:
                        nextPrev("previous"); 
                        break;
                }
            }

            function toggle(showHideDiv) {
                var ele = document.getElementById(showHideDiv);
                if(ele.style.display == "block") {
                    ele.style.display = "none";
                }
                else {
                    ele.style.display = "block";
                    currentlyOpen = showHideDiv;
                    document.getElementById(currentlyOpen).previousElementSibling.getElementsByTagName("h4")[0].style.color = "#08b";
                    setCookie("read",currentlyOpen,30);
                }
            }  
            function toggleall(changeTo){
                var list = document.getElementsByClassName("itemdescription");
                for (var i = 0; i < list.length; i++) {
                    var e = list[i];
                    e.style.display = changeTo;
                }
            }
            
            function nextPrev(direction){
                var divs = document.getElementsByClassName("itemdescription");
                var selectionDiv = document.getElementById(currentlyOpen);
                for(var i=0; i<divs.length; i++) {
                    if(divs[i] == selectionDiv) {
                        var previous = divs[i+1];
                        var next = divs[i-1];
                        break;
                    }
                }
                
                toggleall('none');
                if(direction == "next"){
                    toggle(next.id);
                    window.location = "#" + next.parentNode.id;
/*                    currentlyOpen.parentElement.previousElementSibling.firstElementChild.style.background = "green";*/
                }else{
                    toggle(previous.id);
                    window.location = "#" + previous.parentNode.id;
                }
            }

        </script>
    </head>
    <body id="rawdog" onload="checkCookie()">
        <div id="page">
            <div id="header">
                <h1>rawdog __version__: __num_items__ items from __num_feeds__ feeds</h1>
                <p><a onclick="toggleall('block')">Open all</a> <a onclick="toggleall('none')">Close all</a> </p>
            </div>
            <div class="pages">
                __paged_output_pages__
            </div>
            <div id="items">
                __items__
            </div>
            <div class="pages">
                __paged_output_pages__
            </div>
        </div>
        <a id="toTopButton" href="#">Top^</a>
        <div id="floatingNav">
            <p href="" id="navNext" onclick="nextPrev('next')">&uarr;</p>
            <p href="" id="navPrev" onclick="nextPrev('previous')">&darr;</p>
        </div>
    </body>
</html>
